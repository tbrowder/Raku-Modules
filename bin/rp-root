#!/usr/bin/env raku

use lib <../lib>;
use RakudoPkg;

my $user    = $*USER.lc;
my $is-root = $user eq 'root' ?? True !! False;
my $host    = $*KERNEL.hostname;
my $system  = $*KERNEL.hardware // "Unknown system";
my $distro  = $*DISTRO.name;
my $version = $*DISTRO.version;

my $inst    = 0;
my $minst   = 0;
if not @*ARGS {
    say qq:to/HERE/;
    Usage: {$*PROGRAM.basename} <mode> <item> [options]

    This is a root-only program currently running on:

        Host:    $host
        User:    $user
        Distro:  $distro
        Version: $version
        System:  $system

    Modes:
        install <item>
        remove  <item>
    Items:
        raku
        zef
    Options:
        debug

    HERE
    exit
}

unless $is-root {
    say "FATAL: This program must be executed by the root user.";
    exit;
}

# modes
my $m-inst = 0;
my $m-rm   = 0;
# items
my $i-rak  = 0;
my $i-zef  = 0;
# options
my $debug  = 0;

for @*ARGS {
    # modes
    when /^ i  / { ++$m-inst; $m-rm   = 0; }
    when /^ rm / { ++$m-rm;   $m-inst = 0; }

    # items
    when /^ ra / { ++$i-rak; $i-zef = 0; }
    when /^ z  / { ++$i-zef; $i-rak = 0; }
    # options
    when /^ d / { ++$debug }

    default {
        note "FATAL: Unknown arg '$_'";
        exit;
    }
}


